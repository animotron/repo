<?xml version="1.0" encoding="UTF-8"?>
<the:map-service xmlns:is="animo/relation/is" xmlns:have="animo/relation/have" xmlns:an="animo/reference" xmlns:any="animo/query/any" xmlns:use="animo/relation/use" xmlns:self="animo/query/self" xmlns:the="animo/instance">
    <is:service/>
    
    <have:uri>/map</have:uri>
    
    <an:html-serialization>
        <an:html-composition>
            <have:title>Карта</have:title>
            
            <any:theme/>
            
            <use:jquery/>
            <use:jquery-url/>
            <use:jquery-layout/>
            <use:jquery-history/>
            <use:jquery-prevent-default-event/>
            
            <have:css>
                #header {padding : 10px 10px 20px 10px;}
                #result {overflow : auto;}
            </have:css>
            
            <have:content xmlns="http://www.w3.org/1999/xhtml">
                <script type="text/javascript">
                    
                    $(function(){
                    
                        $("body").layout({
                            west : {
                                size               : 300,
                                minSize            : 200,
                                maxSize            : 400,
                                resizable          : true,
                                slidable           : true,
                                closable           : true,
                                initHidden         : false
                            }
                        });
                        
                        $("#result").hide();
                        
                        $(window).resize(function(){
                            $("#result").height($(window).height() - $("#header").outerHeight());
                        }).resize();
                        
                        var controller = function(){
                            $.url.init();
                            $("#map").trigger("locate", [$.url.param("lon"), $.url.param("lat"), $.url.param("zoom"), $.url.param("bounds"), $.url.param("layers")]);
                        };
                        
                        $(window).bind("statechange", controller);
                        
                    });
                    
                </script>
                
                <an:form>
                    <have:action>/an:html-part/an:geo-content/an:geo-search</have:action>
                    <have:callback>
                        function(data){
                            var html = $(data);
                            html.find("a").click(function(e){
                                if($.preventDefaultEvent(e)) return; History.pushState(null, null, this.href);
                            });
                            $("#result").show().find("ul").html(html);
                        }
                    </have:callback>
                    
                    <have:widget>
                        <div class="body ui-layout-west">
                            
                            <div id="header">
                                <an:logo-widget/>
                                <an:search-widget/>
                            </div>
                            
                            <div id="body">
                                <an:list-widget>
                                    <have:id>result</have:id>
                                </an:list-widget>
                            </div>
                            
                        </div>
                        
                        <div class="ui-layout-center">
                            <an:map-widget>
                                <have:id>map</have:id>
                            </an:map-widget>
                        </div>
                        
                    </have:widget>
                    
                </an:form>
                
            </have:content>
                
        </an:html-composition>
        
    </an:html-serialization>

</the:map-service>