<?xml version="1.0" encoding="UTF-8"?>
<the:html-head xmlns="http://www.w3.org/1999/xhtml" xmlns:do="animo/perform" xmlns:the="animo/instance">
    <head>
        <do:xquery>
(:

Commented for time being

            let $title := normalize-space(string-join(distinct-values($CONTEXT/descendant-or-self::have:title/normalize-space()), ". "))
            return 
                if ($title)
                    then
                        <title>{$title}</title>
                    else
                        (),
:)
            let $title := $CONTEXT/descendant-or-self::have:title
            return 
                if ($title)
                then
                    <title>{$title[1]/text()}</title>
                else
                    (),

            for $i in distinct-values($CONTEXT/descendant-or-self::have:keywords/normalize-space())
            where $i
            return
                <meta name="keywords" content="{$i}"/>,
                                
            for $i in distinct-values($CONTEXT/descendant-or-self::have:description/normalize-space())
            where $i
            return
                <meta name="description" content="{$i}"/>,
            
            let $css := $CONTEXT/descendant-or-self::have:css
            return 
                (
                    for $i in distinct-values($css//have:uri/normalize-space())
                    where $i
                    return
                        <link rel="stylesheet" type="text/css" href="{$i}"/>,
            
                    for $i in distinct-values($css/text()/normalize-space())
                    where $i
                    return
                        <style type="text/css">{$i}</style>
                ),
            
            let $script := $CONTEXT/descendant-or-self::have:script
            return 
                (
                    for $i in distinct-values($script//have:uri/normalize-space())
                    where $i
                    return
                        <script type="text/javascript" src="{$i}"/>,
                
                    for $i in distinct-values($script/text()/normalize-space())
                    where $i
                    return
                        <script type="text/javascript">{$i}</script>
                )
                
        </do:xquery>
    </head>
</the:html-head>